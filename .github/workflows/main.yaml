name: Test mud

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

permissions:
  contents: read

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python 3.10
        uses: actions/setup-python@v3
        with:
          python-version: "3.10"
      - name: Install dependencies and set up the environment
        run: |
          python -m venv .venv
          source .venv/bin/activate
          pip install prettytable
          pip install requests
          chmod +x mud.sh
          echo "$PWD" >> $GITHUB_PATH
      - name: Create repositories
        run: |
          git config --global user.name "Jasur Sadikov"
          git config --global user.email "test@test.com"

          for i in {1..3}; do
              mkdir "repo_$i"
              cd "repo_$i"
              echo "repo_$i" > test.txt
              git init
              git add .
              git commit -m "Initial commit"
              cd ..
          done
      - name: Set up and Initialize
        run: |
          echo -e "[mud]\nrun_async = True\nrun_table = True\nauto_fetch = False\nnerd_fonts = False" > ~/.mudsettings
          ./mud.sh init
      - name: mud remove
        run: |
          for i in {1..3}; do
            ./mud.sh remove repo_$i
          done
      - name: mud add
        run: |
          for i in {1..3}; do
            ./mud.sh add repo_$i label_$i
          done
      - name: mud remove
        run: |
          for i in {1..3}; do
            ./mud.sh remove label_$i
          done
      - name: mud status
        run: ./mud.sh status
      - name: mud info
        run: ./mud.sh info
      - name: mud log
        run: ./mud.sh log
      - name: mud labels
        run: ./mud.sh labels
      - name: mud branch
        run: ./mud.sh branch
      - name: mud tags
        run: ./mud.sh tags